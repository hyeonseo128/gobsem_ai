<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³±ì…ˆê³µì‹ í•™ìŠµ í”„ë¡œê·¸ë¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #2c3e50;
            color: #ecf0f1;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            color: #ecf0f1;
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .mode-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            background-color: #34495e;
            color: #ecf0f1;
            border: 2px solid #4a5f7f;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn:hover {
            background-color: #4a5f7f;
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background-color: #5a7fa7;
            border-color: #7fa7d7;
        }

        .game-area, .ai-area {
            display: none;
            background-color: #34495e;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .game-area.active, .ai-area.active {
            display: block;
        }

        .problem-display {
            background-color: #2c3e50;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.8em;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .problem-display.correct {
            background-color: #27ae60;
            animation: pulse-success 0.5s ease;
        }

        .problem-display.wrong {
            background-color: #c0392b;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        @keyframes pulse-success {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        input[type="text"], select {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            background-color: #2c3e50;
            color: #ecf0f1;
            border: 2px solid #4a5f7f;
            border-radius: 6px;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #7fa7d7;
        }

        .btn {
            padding: 12px 25px;
            font-size: 1.1em;
            background-color: #5a7fa7;
            color: #ecf0f1;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s;
        }

        .btn:hover {
            background-color: #7fa7d7;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background-color: #4a5f7f;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-size: 1.1em;
            display: none;
        }

        .feedback.correct {
            background-color: #27ae60;
            display: block;
        }

        .feedback.wrong {
            background-color: #c0392b;
            display: block;
        }

        .score {
            text-align: center;
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        .ai-comment {
            background-color: #2c3e50;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            min-height: 80px;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .ai-comment.loading {
            opacity: 0.6;
        }

        .difficulty-selector {
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .math-keyboard {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background-color: #2c3e50;
            border-radius: 8px;
        }

        .keyboard-section {
            display: grid;
            gap: 8px;
        }

        .keyboard-section.variables {
            grid-template-columns: repeat(3, 1fr);
        }

        .keyboard-section.operators {
            grid-template-columns: repeat(2, 1fr);
        }

        .keyboard-section.numbers {
            grid-template-columns: repeat(3, 1fr);
        }

        .keyboard-section.special {
            grid-template-columns: repeat(2, 1fr);
        }

        .math-key {
            padding: 15px;
            font-size: 1.3em;
            color: #ecf0f1;
            border: 2px solid #4a5f7f;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .math-key:hover {
            transform: scale(1.05);
        }

        .math-key:active {
            transform: scale(0.95);
        }

        .math-key.var {
            background-color: #8e44ad;
            border-color: #9b59b6;
        }

        .math-key.var:hover {
            background-color: #9b59b6;
        }

        .math-key.op {
            background-color: #d35400;
            border-color: #e67e22;
        }

        .math-key.op:hover {
            background-color: #e67e22;
        }

        .math-key.num {
            background-color: #2980b9;
            border-color: #3498db;
        }

        .math-key.num:hover {
            background-color: #3498db;
        }

        .math-key.special {
            background-color: #34495e;
            border-color: #4a5f7f;
        }

        .math-key.special:hover {
            background-color: #4a5f7f;
        }

        .math-key.wide {
            grid-column: span 2;
        }

        .answer-display {
            background-color: #2c3e50;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 1.2em;
            text-align: center;
            display: none;
        }

        .answer-display.show {
            display: block;
            color: #f39c12;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ê³±ì…ˆê³µì‹ í•™ìŠµ í”„ë¡œê·¸ë¨</h1>

        <div class="mode-selector">
            <button class="mode-btn active" onclick="switchMode('game')">ê³±ì…ˆê³µì‹ ê²Œì„</button>
            <button class="mode-btn" onclick="switchMode('ai')">AI ë¬¸ì œ í’€ì´</button>
        </div>

        <!-- ê²Œì„ ëª¨ë“œ -->
        <div class="game-area active">
            <div class="score">
                ì •ë‹µ: <span id="correctCount">0</span> | ì˜¤ë‹µ: <span id="wrongCount">0</span>
            </div>
            
            <div class="problem-display" id="problemDisplay">
                ë¬¸ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
            </div>

            <div class="answer-display" id="answerDisplay">
                ì •ë‹µ: <span id="correctAnswer"></span>
            </div>

            <div class="input-group">
                <label for="answerInput">ì •ë‹µ ì…ë ¥:</label>
                <input type="text" id="answerInput" placeholder="ì˜ˆ: (x+3)(x-3) ë˜ëŠ” xÂ²-9">
            </div>

            <!-- ìˆ˜í•™ í‚¤ë³´ë“œ -->
            <div class="math-keyboard">
                <div class="keyboard-section variables">
                    <button class="math-key var" onclick="insertMath('a')">a</button>
                    <button class="math-key var" onclick="insertMath('b')">b</button>
                    <button class="math-key var" onclick="insertMath('c')">c</button>
                    <button class="math-key var" onclick="insertMath('d')">d</button>
                    <button class="math-key var" onclick="insertMath('m')">m</button>
                    <button class="math-key var" onclick="insertMath('n')">n</button>
                    <button class="math-key var" onclick="insertMath('x')">x</button>
                    <button class="math-key var" onclick="insertMath('y')">y</button>
                    <button class="math-key var" onclick="insertMath('z')">z</button>
                </div>

                <div class="keyboard-section special">
                    <button class="math-key special" onclick="insertMath('Â²')">xÂ²</button>
                    <button class="math-key special" onclick="insertMath('Â³')">xÂ³</button>
                    <button class="math-key special" onclick="insertMath('â´')">xâ´</button>
                    <button class="math-key special" onclick="insertMath('(')">(</button>
                    <button class="math-key special" onclick="insertMath(')')">)</button>
                    <button class="math-key special" onclick="insertMath('{')">{</button>
                    <button class="math-key special" onclick="insertMath('}')">}</button>
                    <button class="math-key special" onclick="insertMath('|')">|</button>
                    <button class="math-key special wide" onclick="backspaceMath()">âŒ« ì§€ìš°ê¸°</button>
                </div>

                <div class="keyboard-section operators">
                    <button class="math-key op" onclick="insertMath('+')">+</button>
                    <button class="math-key op" onclick="insertMath('-')">-</button>
                    <button class="math-key op" onclick="insertMath('Ã—')">Ã—</button>
                    <button class="math-key op" onclick="insertMath('Ã·')">Ã·</button>
                    <button class="math-key op" onclick="insertMath('=')">=</button>
                    <button class="math-key op" onclick="insertMath('â‰ ')">â‰ </button>
                </div>

                <div class="keyboard-section numbers">
                    <button class="math-key num" onclick="insertMath('7')">7</button>
                    <button class="math-key num" onclick="insertMath('8')">8</button>
                    <button class="math-key num" onclick="insertMath('9')">9</button>
                    <button class="math-key num" onclick="insertMath('4')">4</button>
                    <button class="math-key num" onclick="insertMath('5')">5</button>
                    <button class="math-key num" onclick="insertMath('6')">6</button>
                    <button class="math-key num" onclick="insertMath('1')">1</button>
                    <button class="math-key num" onclick="insertMath('2')">2</button>
                    <button class="math-key num" onclick="insertMath('3')">3</button>
                    <button class="math-key num wide" onclick="insertMath('0')">0</button>
                    <button class="math-key num" onclick="insertMath('.')">.</button>
                </div>
            </div>

            <div class="button-group">
                <button class="btn" onclick="checkAnswer()">í™•ì¸</button>
                <button class="btn" onclick="skipProblem()">ê±´ë„ˆë›°ê¸°</button>
                <button class="btn" id="nextProblemBtn" onclick="nextProblem()" style="display: none;">ë‹¤ìŒ ë¬¸ì œ</button>
            </div>

            <div class="feedback" id="feedback"></div>
        </div>

        <!-- AI ëª¨ë“œ -->
        <div class="ai-area">
            <div class="difficulty-selector">
                <label for="difficulty">ë‚œì´ë„:</label>
                <select id="difficulty">
                    <option value="easy">ì‰¬ì›€ (ê¸°ë³¸ ê³±ì…ˆê³µì‹)</option>
                    <option value="hard">ì–´ë ¤ì›€ (ë³µì¡í•œ ì¸ìˆ˜ë¶„í•´)</option>
                </select>
            </div>

            <div class="problem-display" id="aiProblemDisplay">
                ë¬¸ì œë¥¼ ìƒì„±í•˜ë ¤ë©´ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
            </div>

            <div class="input-group">
                <label for="aiAnswerInput">ì •ë‹µ ì…ë ¥:</label>
                <input type="text" id="aiAnswerInput" placeholder="ì˜ˆ: (x+3)(x-3)">
            </div>

            <!-- ìˆ˜í•™ í‚¤ë³´ë“œ -->
            <div class="math-keyboard">
                <div class="keyboard-section variables">
                    <button class="math-key var" onclick="insertMathAI('a')">a</button>
                    <button class="math-key var" onclick="insertMathAI('b')">b</button>
                    <button class="math-key var" onclick="insertMathAI('c')">c</button>
                    <button class="math-key var" onclick="insertMathAI('d')">d</button>
                    <button class="math-key var" onclick="insertMathAI('m')">m</button>
                    <button class="math-key var" onclick="insertMathAI('n')">n</button>
                    <button class="math-key var" onclick="insertMathAI('x')">x</button>
                    <button class="math-key var" onclick="insertMathAI('y')">y</button>
                    <button class="math-key var" onclick="insertMathAI('z')">z</button>
                </div>

                <div class="keyboard-section special">
                    <button class="math-key special" onclick="insertMathAI('Â²')">xÂ²</button>
                    <button class="math-key special" onclick="insertMathAI('Â³')">xÂ³</button>
                    <button class="math-key special" onclick="insertMathAI('â´')">xâ´</button>
                    <button class="math-key special" onclick="insertMathAI('(')">(</button>
                    <button class="math-key special" onclick="insertMathAI(')')">)</button>
                    <button class="math-key special" onclick="insertMathAI('{')">{</button>
                    <button class="math-key special" onclick="insertMathAI('}')">}</button>
                    <button class="math-key special" onclick="insertMath('|')">|</button>
                    <button class="math-key special" onclick="insertMath('[ë³€í˜•ê³µì‹]')">[ë³€í˜•]</button>
                    <button class="math-key special wide" onclick="backspaceMathAI()">âŒ« ì§€ìš°ê¸°</button>
                </div>

                <div class="keyboard-section operators">
                    <button class="math-key op" onclick="insertMathAI('+')">+</button>
                    <button class="math-key op" onclick="insertMathAI('-')">-</button>
                    <button class="math-key op" onclick="insertMathAI('Ã—')">Ã—</button>
                    <button class="math-key op" onclick="insertMathAI('Ã·')">Ã·</button>
                </div>

                <div class="keyboard-section numbers">
                    <button class="math-key num" onclick="insertMathAI('7')">7</button>
                    <button class="math-key num" onclick="insertMathAI('8')">8</button>
                    <button class="math-key num" onclick="insertMathAI('9')">9</button>
                    <button class="math-key num" onclick="insertMathAI('4')">4</button>
                    <button class="math-key num" onclick="insertMathAI('5')">5</button>
                    <button class="math-key num" onclick="insertMathAI('6')">6</button>
                    <button class="math-key num" onclick="insertMathAI('1')">1</button>
                    <button class="math-key num" onclick="insertMathAI('2')">2</button>
                    <button class="math-key num" onclick="insertMathAI('3')">3</button>
                    <button class="math-key num wide" onclick="insertMathAI('0')">0</button>
                    <button class="math-key special" onclick="insertMathAI('(1/2)')">(1/2)</button>
                    <button class="math-key special" onclick="insertMathAI('(1/3)')">(1/3)</button>
                    <button class="math-key special" onclick="insertMathAI('(1/5)')">(1/5)</button>
                    <button class="math-key num" onclick="insertMathAI('.')">.</button>
                </div>
            </div>

            <div class="button-group">
                <button class="btn" onclick="generateAIProblem()">ìƒˆ ë¬¸ì œ</button>
                <button class="btn" onclick="checkAIAnswer()">í™•ì¸</button>
            </div>

            <div class="feedback" id="aiFeedback"></div>

            <div class="ai-comment" id="aiComment">
                AI ì½”ë©˜íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
            </div>
        </div>
    </div>

    <script>
        // ê³±ì…ˆê³µì‹ ë°ì´í„°ë² ì´ìŠ¤
        const formulas = [
            { factored: 'm(a+b)', expanded: 'ma+mb' },
            { factored: 'm(a-b)', expanded: 'ma-mb' },
            { factored: '(a+b)Â²', expanded: 'aÂ²+2ab+bÂ²' },
            { factored: '(a-b)Â²', expanded: 'aÂ²-2ab+bÂ²' },
            { factored: '(a+b)(a-b)', expanded: 'aÂ²-bÂ²' },
            { factored: '(x+a)(x+b)', expanded: 'xÂ²+(a+b)x+ab' },
            { factored: '(ax+b)(cx+d)', expanded: 'acxÂ²+(ad+bc)x+bd' },
            { factored: '(a+b+c)Â²', expanded: 'aÂ²+bÂ²+cÂ²+2(ab+bc+ca)' },
            { factored: '(a+b)Â³', expanded: 'aÂ³+3aÂ²b+3abÂ²+bÂ³' },
            { factored: '(a-b)Â³', expanded: 'aÂ³-3aÂ²b+3abÂ²-bÂ³' },
            { factored: '(a+b)(aÂ²-ab+bÂ²)', expanded: 'aÂ³+bÂ³' },
            { factored: '(a-b)(aÂ²+ab+bÂ²)', expanded: 'aÂ³-bÂ³' },
            { factored: '(aÂ²+ab+bÂ²)(aÂ²-ab+bÂ²)', expanded: 'aâ´+aÂ²bÂ²+bâ´' },
            { factored: '(a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca)', expanded: 'aÂ³+bÂ³+cÂ³-3abc' },
            { factored: '(x+a)(x+b)(x+c)', expanded: 'xÂ³+(a+b+c)xÂ²+(ab+bc+ca)x+abc' },
            { factored: '(x-a)(x-b)(x-c)', expanded: 'xÂ³-(a+b+c)xÂ²+(ab+bc+ca)x-abc' },
            { factored: 'aÂ²+bÂ²', expanded: '(a+b)Â²-2ab|(a-b)Â²+2ab' },
            { factored: '(a-b)Â²[ë³€í˜•ê³µì‹]', expanded: '(a+b)Â²-4ab' },
            { factored: 'aÂ³-bÂ³[ë³€í˜•ê³µì‹]', expanded: '(a-b)Â³+3ab(a-b)' },
            { factored: 'aÂ³+bÂ³[ë³€í˜•ê³µì‹]', expanded: '(a+b)Â³-3ab(a+b)' },
            { factored: 'aÂ²+bÂ²+cÂ²', expanded: '(a+b+c)Â²-2(ab+bc+ca)' },
            { factored: 'aÂ²+bÂ²+cÂ²-ab-bc-ca', expanded: '(1/2){(a-b)Â²+(b-c)Â²+(c-a)Â²}' },
            { factored: 'aÂ³+bÂ³+cÂ³', expanded: '(a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca)+3abc' }
        ];

        // ê²Œì„ ìƒíƒœ
        let currentProblem = null;
        let usedProblems = [];
        let correctCount = 0;
        let wrongCount = 0;
        let currentMode = 'game';
        let currentAIProblem = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.onload = function() {
            generateProblem();
        };

        // ìˆ˜í•™ í‚¤ë³´ë“œ - ê²Œì„ ëª¨ë“œ
        function insertMath(char) {
            const input = document.getElementById('answerInput');
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(input.selectionEnd);
            
            input.value = textBefore + char + textAfter;
            input.focus();
            input.setSelectionRange(cursorPos + char.length, cursorPos + char.length);
        }

        function backspaceMath() {
            const input = document.getElementById('answerInput');
            const cursorPos = input.selectionStart;
            
            if (cursorPos > 0) {
                const textBefore = input.value.substring(0, cursorPos - 1);
                const textAfter = input.value.substring(input.selectionEnd);
                input.value = textBefore + textAfter;
                input.focus();
                input.setSelectionRange(cursorPos - 1, cursorPos - 1);
            }
        }

        // ìˆ˜í•™ í‚¤ë³´ë“œ - AI ëª¨ë“œ
        function insertMathAI(char) {
            const input = document.getElementById('aiAnswerInput');
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(input.selectionEnd);
            
            input.value = textBefore + char + textAfter;
            input.focus();
            input.setSelectionRange(cursorPos + char.length, cursorPos + char.length);
        }

        function backspaceMathAI() {
            const input = document.getElementById('aiAnswerInput');
            const cursorPos = input.selectionStart;
            
            if (cursorPos > 0) {
                const textBefore = input.value.substring(0, cursorPos - 1);
                const textAfter = input.value.substring(input.selectionEnd);
                input.value = textBefore + textAfter;
                input.focus();
                input.setSelectionRange(cursorPos - 1, cursorPos - 1);
            }
        }

        // ëª¨ë“œ ì „í™˜
        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelector('.game-area').classList.toggle('active', mode === 'game');
            document.querySelector('.ai-area').classList.toggle('active', mode === 'ai');
        }

        // ë¬¸ì œ ìƒì„±
        function generateProblem() {
            if (usedProblems.length === formulas.length) {
                usedProblems = [];
            }

            let availableProblems = formulas.filter((_, index) => !usedProblems.includes(index));
            let randomIndex = Math.floor(Math.random() * availableProblems.length);
            let selectedProblem = availableProblems[randomIndex];
            
            let originalIndex = formulas.indexOf(selectedProblem);
            usedProblems.push(originalIndex);

            let problemType = Math.random() < 0.5 ? 'expand' : 'factor';
            
            currentProblem = {
                type: problemType,
                formula: selectedProblem,
                question: problemType === 'expand' ? selectedProblem.factored : selectedProblem.expanded,
                answer: problemType === 'expand' ? selectedProblem.expanded : selectedProblem.factored
            };

            displayProblem();
            document.getElementById('answerInput').value = '';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('answerDisplay').classList.remove('show');
            document.getElementById('nextProblemBtn').style.display = 'none';
        }

        // ë¬¸ì œ í‘œì‹œ
        function displayProblem() {
            document.getElementById('problemDisplay').innerHTML = `<strong>${currentProblem.question}</strong>`;
        }

        // ë‹µì•ˆ ì •ê·œí™”
        function normalizeAnswer(answer) {
            return answer.replace(/\s+/g, '').toLowerCase()
                .replace(/\*\*/g, '^')
                .replace(/\*/g, '')
                .replace(/\^2/g, 'Â²');
        }

        // ë‹µ í™•ì¸
        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value;
            const normalizedUser = normalizeAnswer(userAnswer);
            const normalizedCorrect = normalizeAnswer(currentProblem.answer);

            const feedbackDiv = document.getElementById('feedback');
            const problemDisplay = document.getElementById('problemDisplay');
            const answerDisplay = document.getElementById('answerDisplay');
            const nextBtn = document.getElementById('nextProblemBtn');
            
            if (normalizedUser === normalizedCorrect) {
                problemDisplay.classList.remove('wrong');
                problemDisplay.classList.add('correct');
                
                feedbackDiv.className = 'feedback correct';
                feedbackDiv.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰';
                correctCount++;
                updateScore();
                
                answerDisplay.classList.remove('show');
                nextBtn.style.display = 'none';
                
                setTimeout(() => {
                    problemDisplay.classList.remove('correct');
                    generateProblem();
                }, 1000);
            } else {
                problemDisplay.classList.remove('correct');
                problemDisplay.classList.add('wrong');
                
                feedbackDiv.className = 'feedback wrong';
                feedbackDiv.textContent = 'ì˜¤ë‹µì…ë‹ˆë‹¤.';
                wrongCount++;
                updateScore();
                
                // ì •ë‹µ í‘œì‹œ
                document.getElementById('correctAnswer').textContent = currentProblem.answer;
                answerDisplay.classList.add('show');
                
                // ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ í‘œì‹œ
                nextBtn.style.display = 'inline-block';
                
                setTimeout(() => {
                    problemDisplay.classList.remove('wrong');
                }, 500);
            }
        }

        // ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateScore() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
        }

        // ë¬¸ì œ ê±´ë„ˆë›°ê¸°
        function skipProblem() {
            generateProblem();
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextProblem() {
            generateProblem();
        }

        // Enter í‚¤ ì²˜ë¦¬
        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        document.getElementById('aiAnswerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAIAnswer();
            }
        });

        // AI ë¬¸ì œ ìƒì„±
        async function generateAIProblem() {
            const difficulty = document.getElementById('difficulty').value;
            const problemDisplay = document.getElementById('aiProblemDisplay');
            
            problemDisplay.innerHTML = 'ë¬¸ì œ ìƒì„± ì¤‘...';

            try {
                const prompt = difficulty === 'easy' 
                    ? 'ê³±ì…ˆê³µì‹ì˜ í˜•íƒœê°€ ëª…í™•í•œ ì¸ìˆ˜ë¶„í•´ ë¬¸ì œë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì£¼ì„¸ìš”. ë¬¸ì œë§Œ ê°„ë‹¨íˆ ì œì‹œí•˜ì„¸ìš”. ì˜ˆ: xÂ²+6x+9 ì•„ë¬´ í…ìŠ¤íŠ¸ ì—†ì´ ë¬¸ì œë§Œ ì¶œë ¥í•´ì£¼ì„¸ìš”. $ì™€ ^ê°™ì€ ë¬¸ìëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê³  ì œê³±ê¸°í˜¸ëŠ” ìœ„ì²¨ìë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”. x,y,z,a,b ë“±ì˜ ì•ŒíŒŒë²³ ê¸°í˜¸ëŠ” ìˆ˜í•™ì—ì„œ ë‚˜ì˜¤ëŠ” ëª¨ì–‘ì˜ í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”. ì‚¬ìš© ê°€ëŠ¥í•œ ê³±ì…ˆ ê³µì‹ì€ m(a+b)=ma+mb, ma+mb=m(a+b), m(a-b)=ma-mb, ma-mb=m(a-b), (a+b)Â²=aÂ²+2ab+bÂ², aÂ²+2ab+bÂ²=(a+b)Â², (a-b)Â²=aÂ²-2ab+bÂ², aÂ²-2ab+bÂ²=(a-b)Â², (a+b)(a-b)=aÂ²-bÂ², aÂ²-bÂ²=(a+b)(a-b), (x+a)(x+b)=xÂ²+(a+b)x+ab, xÂ²+(a+b)x+ab=(x+a)(x+b), (ax+b)(cx+d)=acxÂ²+(ad+bc)x+bd, acxÂ²+(ad+bc)x+bd=(ax+b)(cx+d), (a+b+c)Â²=aÂ²+bÂ²+cÂ²+2(ab+bc+ca), aÂ²+bÂ²+cÂ²+2(ab+bc+ca)=(a+b+c)Â², (a+b)Â³=aÂ³+3aÂ²b+3abÂ²+bÂ³, aÂ³+3aÂ²b+3abÂ²+bÂ³=(a+b)Â³, (a-b)Â³=aÂ³-3aÂ²b+3abÂ²-bÂ³, aÂ³-3aÂ²b+3abÂ²-bÂ³=(a-b)Â³, (a+b)(aÂ²-ab+bÂ²)=aÂ³+bÂ³, aÂ³+bÂ³=(a+b)(aÂ²-ab+bÂ²), (a-b)(aÂ²+ab+bÂ²)=aÂ³-bÂ³, aÂ³-bÂ³=(a-b)(aÂ²+ab+bÂ²), (aÂ²+ab+bÂ²)(aÂ²-ab+bÂ²)=aâ´+aÂ²bÂ²+bâ´, aâ´+aÂ²bÂ²+bâ´=(aÂ²+ab+bÂ²)(aÂ²-ab+bÂ²), (a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca)=aÂ³+bÂ³+cÂ³-3abc, aÂ³+bÂ³+cÂ³-3abc=(a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca), (x+a)(x+b)(x+c)=xÂ³+(a+b+c)xÂ²+(ab+bc+ca)x+abc, xÂ³+(a+b+c)xÂ²+(ab+bc+ca)x+abc=(x+a)(x+b)(x+c), (x-a)(x-b)(x-c)=xÂ³-(a+b+c)xÂ²+(ab+bc+ca)x-abc, xÂ³-(a+b+c)xÂ²+(ab+bc+ca)x-abc=(x-a)(x-b)(x-c), aÂ²+bÂ²=(a+b)Â²-2ab, (a+b)Â²-2ab=aÂ²+bÂ², aÂ²+bÂ²=(a-b)Â²+2ab, (a-b)Â²+2ab=aÂ²+bÂ², (a-b)Â²=(a+b)Â²-4ab, (a+b)Â²-4ab=(a-b)Â², aÂ³-bÂ³=(a-b)Â³+3ab(a-b), (a-b)Â³+3ab(a-b)=aÂ³-bÂ³, aÂ³+bÂ³=(a+b)Â³-3ab(a+b), (a+b)Â³-3ab(a+b)=aÂ³+bÂ³, aÂ²+bÂ²+cÂ²=(a+b+c)Â²-2(ab+bc+ca), (a+b+c)Â²-2(ab+bc+ca)=aÂ²+bÂ²+cÂ², aÂ²+bÂ²+cÂ²-ab-bc-ca=(1/2){(a-b)Â²+(b-c)Â²+(c-a)Â²}, (1/2){(a-b)Â²+(b-c)Â²+(c-a)Â²}=aÂ²+bÂ²+cÂ²-ab-bc-ca, aÂ³+bÂ³+cÂ³=(a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca)+3abc, (a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca)+3abc=aÂ³+bÂ³+cÂ³  ì…ë‹ˆë‹¤.'
                    : 'ë³µì¡í•œ ì¸ìˆ˜ë¶„í•´ ë¬¸ì œë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì£¼ì„¸ìš”. í•­ì„ ë¶„ë¦¬í•˜ê±°ë‚˜ ì¬ë°°ì¹˜í•´ì•¼ ê³±ì…ˆê³µì‹ì„ ì ìš©í•  ìˆ˜ ìˆëŠ” í˜•íƒœì—¬ì•¼ í•©ë‹ˆë‹¤. ë¬¸ì œë§Œ ê°„ë‹¨íˆ ì œì‹œí•˜ì„¸ìš”. ì˜ˆ: 4xÂ²+12x+9-yÂ². ì•„ë¬´ í…ìŠ¤íŠ¸ ì—†ì´ ë¬¸ì œë§Œ ì¶œë ¥í•´ì£¼ì„¸ìš”. $ì™€ ^ê°™ì€ ë¬¸ìëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê³  ì œê³±ê¸°í˜¸ëŠ” ìœ„ì²¨ìë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”. x,y,z,a,b ë“±ì˜ ì•ŒíŒŒë²³ ê¸°í˜¸ëŠ” ìˆ˜í•™ì—ì„œ ë‚˜ì˜¤ëŠ” ëª¨ì–‘ì˜ í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”. ì‚¬ìš© ê°€ëŠ¥í•œ ê³±ì…ˆ ê³µì‹ì€ m(a+b)=ma+mb, ma+mb=m(a+b), m(a-b)=ma-mb, ma-mb=m(a-b), (a+b)Â²=aÂ²+2ab+bÂ², aÂ²+2ab+bÂ²=(a+b)Â², (a-b)Â²=aÂ²-2ab+bÂ², aÂ²-2ab+bÂ²=(a-b)Â², (a+b)(a-b)=aÂ²-bÂ², aÂ²-bÂ²=(a+b)(a-b), (x+a)(x+b)=xÂ²+(a+b)x+ab, xÂ²+(a+b)x+ab=(x+a)(x+b), (ax+b)(cx+d)=acxÂ²+(ad+bc)x+bd, acxÂ²+(ad+bc)x+bd=(ax+b)(cx+d), (a+b+c)Â²=aÂ²+bÂ²+cÂ²+2(ab+bc+ca), aÂ²+bÂ²+cÂ²+2(ab+bc+ca)=(a+b+c)Â², (a+b)Â³=aÂ³+3aÂ²b+3abÂ²+bÂ³, aÂ³+3aÂ²b+3abÂ²+bÂ³=(a+b)Â³, (a-b)Â³=aÂ³-3aÂ²b+3abÂ²-bÂ³, aÂ³-3aÂ²b+3abÂ²-bÂ³=(a-b)Â³, (a+b)(aÂ²-ab+bÂ²)=aÂ³+bÂ³, aÂ³+bÂ³=(a+b)(aÂ²-ab+bÂ²), (a-b)(aÂ²+ab+bÂ²)=aÂ³-bÂ³, aÂ³-bÂ³=(a-b)(aÂ²+ab+bÂ²), (aÂ²+ab+bÂ²)(aÂ²-ab+bÂ²)=aâ´+aÂ²bÂ²+bâ´, aâ´+aÂ²bÂ²+bâ´=(aÂ²+ab+bÂ²)(aÂ²-ab+bÂ²), (a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca)=aÂ³+bÂ³+cÂ³-3abc, aÂ³+bÂ³+cÂ³-3abc=(a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca), (x+a)(x+b)(x+c)=xÂ³+(a+b+c)xÂ²+(ab+bc+ca)x+abc, xÂ³+(a+b+c)xÂ²+(ab+bc+ca)x+abc=(x+a)(x+b)(x+c), (x-a)(x-b)(x-c)=xÂ³-(a+b+c)xÂ²+(ab+bc+ca)x-abc, xÂ³-(a+b+c)xÂ²+(ab+bc+ca)x-abc=(x-a)(x-b)(x-c), aÂ²+bÂ²=(a+b)Â²-2ab, (a+b)Â²-2ab=aÂ²+bÂ², aÂ²+bÂ²=(a-b)Â²+2ab, (a-b)Â²+2ab=aÂ²+bÂ², (a-b)Â²=(a+b)Â²-4ab, (a+b)Â²-4ab=(a-b)Â², aÂ³-bÂ³=(a-b)Â³+3ab(a-b), (a-b)Â³+3ab(a-b)=aÂ³-bÂ³, aÂ³+bÂ³=(a+b)Â³-3ab(a+b), (a+b)Â³-3ab(a+b)=aÂ³+bÂ³, aÂ²+bÂ²+cÂ²=(a+b+c)Â²-2(ab+bc+ca), (a+b+c)Â²-2(ab+bc+ca)=aÂ²+bÂ²+cÂ², aÂ²+bÂ²+cÂ²-ab-bc-ca=(1/2){(a-b)Â²+(b-c)Â²+(c-a)Â²}, (1/2){(a-b)Â²+(b-c)Â²+(c-a)Â²}=aÂ²+bÂ²+cÂ²-ab-bc-ca, aÂ³+bÂ³+cÂ³=(a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca)+3abc, (a+b+c)(aÂ²+bÂ²+cÂ²-ab-bc-ca)+3abc=aÂ³+bÂ³+cÂ³  ì…ë‹ˆë‹¤.';

                const response = await fetch("/api/gemini", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        type: "generate",
                        prompt: prompt
                    })
                });

                if (!response.ok) {
                    throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
                }

                const data = await response.json();
                const problemText = data.text.trim();

                currentAIProblem = {
                    problem: problemText,
                    difficulty: difficulty
                };

                problemDisplay.innerHTML = `<strong>${problemText}</strong>`;

                document.getElementById('aiAnswerInput').value = '';
                document.getElementById('aiFeedback').style.display = 'none';
                document.getElementById('aiComment').innerHTML = 'AI ì½”ë©˜íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤';
            } catch (error) {
                problemDisplay.innerHTML = `ë¬¸ì œ ìƒì„± ì‹¤íŒ¨: ${error.message}`;
                console.error('Error:', error);
            }
        }

        // AI ë‹µì•ˆ í™•ì¸
        async function checkAIAnswer() {
            if (!currentAIProblem) {
                alert('ë¨¼ì € ë¬¸ì œë¥¼ ìƒì„±í•˜ì„¸ìš”!');
                return;
            }

            const userAnswer = document.getElementById('aiAnswerInput').value.trim();
            if (!userAnswer) {
                alert('ë‹µì„ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }

            const commentDiv = document.getElementById('aiComment');
            commentDiv.classList.add('loading');
            commentDiv.innerHTML = 'AIê°€ ë‹µì•ˆì„ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...';

            try {
                const prompt = `ë‹¤ìŒ ì¸ìˆ˜ë¶„í•´ ë¬¸ì œì— ëŒ€í•œ í•™ìƒì˜ ë‹µì„ í‰ê°€í•˜ê³  í”¼ë“œë°±ì„ ì£¼ì„¸ìš”. ë‹¨, ($,^ ë“±ì˜ ê¸°í˜¸ë¥¼ ì“°ì§€ë§ê³ , ì œê³±ì€ ìœ„ì²¨ì ì œê³±ê¸°í˜¸ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.)

ë¬¸ì œ: ${currentAIProblem.problem}
í•™ìƒì˜ ë‹µ: ${userAnswer}

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”:
1. ì •ë‹µ ì—¬ë¶€ (ë§ìŒ/í‹€ë¦¼)
2. ì •í™•í•œ ë‹µ
3. í˜„ì¬ ë¬¸ì œì˜ ìœ í˜• 

ì¹œê·¼í•˜ê³  ê²©ë ¤í•˜ëŠ” í†¤ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.`;

                const response = await fetch("/api/gemini", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        type: "check",
                        prompt: prompt
                    })
                });

                if (!response.ok) {
                    throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.text;

                commentDiv.classList.remove('loading');
                commentDiv.innerHTML = aiResponse.replace(/\n/g, '<br>');

                const feedbackDiv = document.getElementById('aiFeedback');
                if (aiResponse.includes('ë§ìŒ') || aiResponse.includes('ì •ë‹µ')) {
                    feedbackDiv.className = 'feedback correct';
                    feedbackDiv.textContent = 'ì˜í–ˆìŠµë‹ˆë‹¤! âœ“';
                } else {
                    feedbackDiv.className = 'feedback wrong';
                    feedbackDiv.textContent = 'ë‹¤ì‹œ í•œ ë²ˆ ì‹œë„í•´ë³´ì„¸ìš”.';
                }
            } catch (error) {
                commentDiv.classList.remove('loading');
                commentDiv.innerHTML = `AI ì‘ë‹µ ì‹¤íŒ¨: ${error.message}`;
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>